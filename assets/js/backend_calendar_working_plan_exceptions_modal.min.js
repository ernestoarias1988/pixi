window.BackendCalendarWorkingPlanExceptionsModal=window.BackendCalendarWorkingPlanExceptionsModal||{},function(e){"use strict";e.resetWorkingPlanExceptionModal=function(){$("#manage-working-plan-exceptions").find("#working-plan-exception-id").val("");var e,a=new Date,n="regular"===GlobalVariables.timeFormat?"8:00 AM":"08:00",t="regular"===GlobalVariables.timeFormat?"8:00 PM":"20:00";switch(GlobalVariables.dateFormat){case"DMY":e="dd/mm/yy";break;case"MDY":e="mm/dd/yy";break;case"YMD":e="yy/mm/dd"}$("#working-plan-exception-date").datepicker({dateFormat:e,dayNames:[EALang.sunday,EALang.monday,EALang.tuesday,EALang.wednesday,EALang.thursday,EALang.friday,EALang.saturday],dayNamesShort:[EALang.sunday.substr(0,3),EALang.monday.substr(0,3),EALang.tuesday.substr(0,3),EALang.wednesday.substr(0,3),EALang.thursday.substr(0,3),EALang.friday.substr(0,3),EALang.saturday.substr(0,3)],dayNamesMin:[EALang.sunday.substr(0,2),EALang.monday.substr(0,2),EALang.tuesday.substr(0,2),EALang.wednesday.substr(0,2),EALang.thursday.substr(0,2),EALang.friday.substr(0,2),EALang.saturday.substr(0,2)],monthNames:[EALang.january,EALang.february,EALang.march,EALang.april,EALang.may,EALang.june,EALang.july,EALang.august,EALang.september,EALang.october,EALang.november,EALang.december],prevText:EALang.previous,nextText:EALang.next,currentText:EALang.now,closeText:EALang.close,timeOnlyTitle:EALang.select_time,timeText:EALang.time,hourText:EALang.hour,minuteText:EALang.minutes,firstDay:0}),$("#working-plan-exception-date").val(GeneralFunctions.formatDate(a,GlobalVariables.dateFormat,!1)),$("#working-plan-exception-start").timepicker({timeFormat:"regular"===GlobalVariables.timeFormat?"h:mm tt":GlobalVariables.timeFormat,prevText:EALang.previous,nextText:EALang.next,currentText:EALang.now,closeText:EALang.close,timeOnlyTitle:EALang.select_time,timeText:EALang.time,hourText:EALang.hour,minuteText:EALang.minutes,firstDay:0}),$("#working-plan-exception-start").val(n),$("#working-plan-exception-end").timepicker({timeFormat:"regular"===GlobalVariables.timeFormat?"h:mm tt":GlobalVariables.timeFormat,prevText:EALang.previous,nextText:EALang.next,currentText:EALang.now,closeText:EALang.close,timeOnlyTitle:EALang.select_time,timeText:EALang.time,hourText:EALang.hour,minuteText:EALang.minutes,firstDay:0}),$("#working-plan-exception-end").val(t)},e.initialize=function(){GlobalVariables.availableProviders.forEach(function(e){$("#working-plan-exception-provider").append(new Option(e.first_name+" "+e.last_name,e.id))}),$("#manage-working-plan-exceptions #save-working-plan-exception").on("click",function(){$("#manage-working-plan-exceptions .modal-message").addClass("hidden"),$("#manage-working-plan-exceptions").find(".has-error").removeClass("has-error");var r=$("#working-plan-exception-date").datetimepicker("getDate");if(r){var i=$("#working-plan-exception-start").datetimepicker("getDate");if(i){var o=Date.parse($("#working-plan-exception-end").datetimepicker("getDate"));if(o){if(o<i)return $("#manage-working-plan-exceptions .modal-message").text(EALang.start_date_before_end_error).addClass("alert-danger").removeClass("hidden"),$("#working-plan-exception-start").addClass("has-error"),void $("#working-plan-exception-end").addClass("has-error");var e={start:i.toString("HH:mm"),end:o.toString("HH:mm"),breaks:[]};BackendCalendarApi.saveWorkingPlanException(r,e,provider.id,function(){Backend.displayNotification(EALang.working_plan_exception_saved),$("#manage-working-plan-exceptions .modal-message").addClass("hidden"),$("#manage-working-plan-exceptions").modal("hide");var a=$("#working-plan-exception-provider").val(),e=GlobalVariables.availableProviders.find(function(e){return Number(e.id)===Number(a)});if(!e)throw new Error("Provider could not be found: "+a);var n=r.toString("yyyy-MM-dd"),t=JSON.parse(e.settings.working_plan_exceptions);t[n]={start:i.toString("HH:mm"),end:o.toString("HH:mm"),breaks:[]},e.settings.working_plan_exceptions=JSON.stringify(t),$("#select-filter-item").trigger("change")},null)}else $("#working-plan-exception-end").closest(".form-group").addClass("has-error")}else $("#working-plan-exception-start").closest(".form-group").addClass("has-error")}else $("#working-plan-exception-date").closest(".form-group").addClass("has-error")}),$("#insert-working-plan-exception").on("click",function(){BackendCalendarWorkingPlanExceptionsModal.resetWorkingPlanExceptionModal(),0===$(".calendar-view").length&&$("#manage-working-plan-exceptions").find("#working-plan-exception-provider").val($("#select-filter-item").val()).closest(".form-group").hide(),$("#working-plan-exception-date").val(GeneralFunctions.formatDate(new Date,GlobalVariables.dateFormat,!1)),$("#working-plan-exception-start").val("regular"===GlobalVariables.timeFormat?"8:00 AM":"08:00"),$("#working-plan-exception-end").val("regular"===GlobalVariables.timeFormat?"8:00 PM":"20:00"),$("#manage-working-plan-exceptions").find(".modal-header h3").text(EALang.new_working_plan_exception_title),$("#manage-working-plan-exceptions").modal("show")})}}(window.BackendCalendarWorkingPlanExceptionsModal);